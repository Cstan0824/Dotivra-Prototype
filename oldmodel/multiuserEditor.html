<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Editor with AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'google-sans': ['Google Sans', 'Roboto', 'Arial', 'sans-serif'],
                        'times': ['Times New Roman', 'serif'],
                    },
                    colors: {
                        'google-blue': '#1a73e8',
                        'google-blue-dark': '#1557b0',
                        'google-gray': '#5f6368',
                        'google-gray-dark': '#3c4043',
                        'google-gray-light': '#f1f3f4',
                        'google-border': '#e8eaed',
                        'google-bg': '#f9fbfd',
                        'google-chat-bg': '#fafbfc',
                    }
                }
            }
        }
    </script>
    <style>
        .chat-input:focus {
            box-shadow: 0 0 0 1px #1a73e8;
        }
        .document-shadow {
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        
        /* Multi-user collaboration styles */
        .user-avatar {
            position: relative;
            display: inline-block;
        }
        
        .user-status {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            border: 2px solid white;
        }
        
        .user-status.online {
            background-color: #10b981;
        }
        
        .user-status.editing {
            background-color: #f59e0b;
            animation: pulse-editing 2s infinite;
        }
        
        @keyframes pulse-editing {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .tab-container {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e8eaed;
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .tab-container::-webkit-scrollbar {
            display: none;
        }
        
        .document-tab {
            padding: 8px 16px;
            border-right: 1px solid #e8eaed;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 150px;
            background: white;
            transition: all 0.2s;
            position: relative;
        }
        
        .document-tab:hover {
            background: #f1f3f4;
        }
        
        .document-tab.active {
            background: white;
            border-bottom: 2px solid #1a73e8;
        }
        
        .document-tab.locked {
            background: #fef3c7;
            border-bottom: 2px solid #f59e0b;
        }
        
        .tab-title {
            font-size: 13px;
            font-weight: 500;
            color: #3c4043;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .tab-lock-icon {
            color: #f59e0b;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .document-tab.locked .tab-lock-icon {
            opacity: 1;
        }
        
        .tab-user-indicator {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            font-size: 8px;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .lock-reminder {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 1px solid #e8eaed;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            padding: 24px;
            max-width: 400px;
            z-index: 1000;
            display: none;
        }
        
        .lock-reminder.show {
            display: block;
            animation: fadeInScale 0.3s ease-out;
        }
        
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        .selected-line {
            background: #e3f2fd !important;
            border-left: 3px solid #1a73e8;
            margin-left: -3px;
            padding-left: 3px;
        }
        
        .line-highlight {
            background: rgba(26, 115, 232, 0.1);
            border-radius: 3px;
            transition: all 0.2s;
        }
        
        /* Sidebar styles */
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #e8eaed;
            overflow-y: auto;
            flex-shrink: 0;
        }
        
        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid #e8eaed;
            font-weight: 500;
            color: #3c4043;
            font-size: 14px;
        }
        
        .sidebar-tab {
            padding: 12px 16px;
            border-bottom: 1px solid #f1f3f4;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .sidebar-tab:hover {
            background: #f8f9fa;
        }
        
        .sidebar-tab.active {
            background: #e8f0fe;
            border-right: 3px solid #1a73e8;
        }
        
        .sidebar-tab.locked {
            background: #fef7cd;
            border-right: 3px solid #f9ab00;
        }
        
        .sidebar-tab-title {
            font-size: 13px;
            font-weight: 500;
            color: #3c4043;
            margin-bottom: 4px;
        }
        
        .sidebar-tab-meta {
            font-size: 11px;
            color: #5f6368;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .sidebar-lock-icon {
            color: #f9ab00;
        }
        
        .sidebar-user-info {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .sidebar-user-avatar {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            font-size: 8px;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Make document scrollable */
        .editor-content {
            flex: 1;
            overflow-y: auto;
            height: 100vh;
        }
        
        .document-wrapper {
            padding: 40px 20px;
            min-height: calc(100vh - 120px);
        }
        
        /* Text selection highlighting */
        .text-selection {
            background: #b3d9ff;
            border-radius: 2px;
            padding: 0 2px;
            margin: 0 1px;
        }
        
        /* Compact file indicator */
        .file-indicator {
            background: #f1f3f4;
            border: 1px solid #dadce0;
            border-radius: 16px;
            padding: 4px 8px;
            font-size: 11px;
            color: #5f6368;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 8px;
        }
        
        .file-indicator-icon {
            width: 12px;
            height: 12px;
        }
        
        /* Enhanced sidebar styles for detailed outline */
        .sidebar-section-header {
            font-size: 12px;
            font-weight: 600;
            color: #3c4043;
            padding: 8px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #e8eaed;
        }
        
        .sidebar-item {
            padding: 6px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #5f6368;
            border-bottom: 1px solid #f8f9fa;
            transition: all 0.2s;
        }
        
        .sidebar-item:hover {
            background: #f1f3f4;
        }
        
        .sidebar-item.active {
            background: #e8f0fe;
            border-right: 2px solid #1a73e8;
            color: #1a73e8;
        }
        
        .sidebar-item.locked {
            background: #fef7cd;
            color: #f9ab00;
        }
        
        .sidebar-subitem {
            padding-left: 32px;
            font-size: 11px;
        }
        
        .sidebar-subitem-deep {
            padding-left: 48px;
            font-size: 11px;
            color: #70757a;
        }
        
        .section-number {
            font-weight: 500;
            min-width: 24px;
        }
        
        .section-title {
            flex: 1;
        }
        
        /* User editing indicators */
        .user-editing {
            position: relative;
            border-left: 3px solid #f59e0b !important;
            background: rgba(245, 158, 11, 0.05) !important;
        }
        
        .user-cursor {
            position: relative;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        @keyframes pulse {
            0%, 100% { background-color: #fbbf24; }
            50% { background-color: #f59e0b; }
        }
        
        .being-edited {
            position: relative;
            animation: pulse 2s infinite !important;
        }
        
        .user-selection {
            animation: fadeInOut 3s infinite;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        /* Enhanced multi-user editing styles */
        .editing-indicator {
            position: absolute;
            right: 80px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .user-presence {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(245, 158, 11, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }
        
        .user-avatar-small {
            width: 16px;
            height: 16px;
            background: #f59e0b;
            border: 2px solid white;
            border-radius: 50%;
            font-size: 8px;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Dynamic highlight indicators */
        .highlight-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 8px;
            background: #e8f0fe;
            border: 1px solid #1a73e8;
            border-radius: 6px;
            font-size: 11px;
            color: #1a73e8;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .highlight-indicator-close {
            background: none;
            border: none;
            color: #1a73e8;
            cursor: pointer;
            padding: 0;
            margin-left: 4px;
            font-size: 12px;
            line-height: 1;
        }
        
        .highlight-indicator-close:hover {
            background: rgba(26, 115, 232, 0.1);
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Toolbar styles */
        .toolbar-btn {
            transition: all 0.2s ease-in-out;
        }
        .toolbar-btn:hover {
            background-color: #f1f3f4 !important;
        }
        .toolbar-btn.active {
            background-color: #e8f0fe;
            color: #1a73e8;
        }
        /* Custom select styling */
        select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'><path fill='%235f6368' d='M2 0L0 2h4zm0 5L0 3h4z'/></svg>");
            background-repeat: no-repeat;
            background-position: right 6px center;
            background-size: 8px;
            padding-right: 20px;
            min-width: 80px;
        }
        
        /* Remove default select styling issues */
        select:focus {
            outline: none;
            box-shadow: 0 0 0 1px #1a73e8;
        }
    </style>
</head>
<body class="font-google-sans bg-google-bg min-h-screen">
    <div class="flex min-h-screen relative">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                Document tabs
                <button class="float-right text-gray-400 hover:text-gray-600">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"/>
                    </svg>
                </button>
            </div>
            
            <div class="sidebar-tab active" data-tab="executive">
                <div class="sidebar-tab-title">1.0 Executive Summary</div>
                <div class="sidebar-tab-meta">
                    <span>Lines 1-3</span>
                    <div class="sidebar-user-info">
                        <div class="sidebar-user-avatar" style="background: #10b981;">✓</div>
                        <span>Available</span>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-tab" data-tab="business">
                <div class="sidebar-tab-title">2.0 Business Description</div>
                <div class="sidebar-tab-meta">
                    <span>Lines 4-6</span>
                    <div class="sidebar-user-info">
                        <div class="sidebar-user-avatar" style="background: #6b7280;">•</div>
                        <span>Available</span>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-tab" data-tab="overview">
                <div class="sidebar-tab-title">2.1 Company Overview</div>
                <div class="sidebar-tab-meta">
                    <span>Lines 7-8</span>
                    <div class="sidebar-user-info">
                        <div class="sidebar-user-avatar" style="background: #6b7280;">•</div>
                        <span>Available</span>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-tab locked" data-tab="products">
                <div class="sidebar-tab-title">2.2 Products and Services</div>
                <div class="sidebar-tab-meta">
                    <span>Lines 9-10</span>
                    <svg class="w-3 h-3 sidebar-lock-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"/>
                    </svg>
                    <div class="sidebar-user-info">
                        <div class="sidebar-user-avatar" style="background: #f9ab00;">A</div>
                        <span>Alex editing</span>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-tab" data-tab="market">
                <div class="sidebar-tab-title">2.3 Market Analysis</div>
                <div class="sidebar-tab-meta">
                    <span>Lines 11-12</span>
                    <div class="sidebar-user-info">
                        <div class="sidebar-user-avatar" style="background: #6b7280;">•</div>
                        <span>Available</span>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-tab" data-tab="competitive">
                <div class="sidebar-tab-title">2.4 Competitive Analysis</div>
                <div class="sidebar-tab-meta">
                    <span>Lines 13-14</span>
                    <div class="sidebar-user-info">
                        <div class="sidebar-user-avatar" style="background: #6b7280;">•</div>
                        <span>Available</span>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-tab" data-tab="strategy">
                <div class="sidebar-tab-title">2.5 Marketing Strategy</div>
                <div class="sidebar-tab-meta">
                    <span>Lines 15-16</span>
                    <div class="sidebar-user-info">
                        <div class="sidebar-user-avatar" style="background: #6b7280;">•</div>
                        <span>Available</span>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-tab" data-tab="industry">
                <div class="sidebar-tab-title">3.0 Industry Analysis</div>
                <div class="sidebar-tab-meta">
                    <span>Lines 17-18</span>
                    <div class="sidebar-user-info">
                        <div class="sidebar-user-avatar" style="background: #6b7280;">•</div>
                        <span>Available</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Editor Section -->
        <div class="flex-1 flex flex-col bg-white transition-all duration-300 ease-in-out" id="editorSection">
            <!-- Header -->
            <div class="bg-white text-google-gray px-5 py-3 flex justify-between items-center border-b border-google-border shadow-sm">
                <div class="flex items-center gap-4">
                    <div class="text-lg font-normal text-google-gray-dark">Untitled document</div>
                    <!-- Multi-user indicators -->
                    <div class="flex items-center gap-2">
                        <div class="user-avatar">
                            <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-semibold">
                                A
                            </div>
                            <div class="user-status editing"></div>
                        </div>
                        <div class="user-avatar">
                            <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-sm font-semibold">
                                B
                            </div>
                            <div class="user-status online"></div>
                        </div>
                        <div class="user-avatar">
                            <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white text-sm font-semibold">
                                C
                            </div>
                            <div class="user-status online"></div>
                        </div>
                        <div class="text-xs text-gray-500 ml-2">3 users editing</div>
                    </div>
                </div>
                <button class="bg-google-blue text-white border-none px-4 py-2 rounded-full cursor-pointer text-sm font-medium transition-all duration-200 ease-in-out flex items-center gap-2 hover:bg-google-blue-dark hover:shadow-md" id="aiToggleBtn">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l3.09 6.26L22 9l-5.91 4.74L18 22l-6-3.27L6 22l1.91-8.26L2 9l6.91-.74L12 2z"/>
                    </svg>
                    AI Assistant
                </button>
            </div>

            <!-- Google Docs Style Toolbar -->
            <div class="bg-white border-b border-google-border px-6 py-2 shadow-sm">
                <div class="flex items-center justify-center space-x-1 max-w-6xl mx-auto">
                    <!-- File Operations -->
                    <div class="flex items-center space-x-1 border-r border-gray-300 pr-3 mr-3">
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Print" id="printBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zM5 14H4v-2h1v2zm1 0v2h8v-2H6zm10-2h-1v2h1v-2z"/>
                            </svg>
                        </button>
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Undo" id="undoBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"/>
                            </svg>
                        </button>
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Redo" id="redoBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"/>
                            </svg>
                        </button>
                    </div>

                    <!-- Zoom -->
                    <div class="flex items-center space-x-1 border-r border-gray-300 pr-3 mr-3">
                        <select class="text-sm border-none outline-none text-google-gray bg-white cursor-pointer" id="zoomSelect">
                            <option value="75">75%</option>
                            <option value="90">90%</option>
                            <option value="100" selected>100%</option>
                            <option value="125">125%</option>
                            <option value="150">150%</option>
                        </select>
                    </div>

                    <!-- Text Formatting -->
                    <div class="flex items-center space-x-1 border-r border-gray-300 pr-3 mr-3">
                        <select class="text-sm border-none outline-none mr-2 text-google-gray bg-white cursor-pointer" id="fontFamily">
                            <option value="Arial" selected>Arial</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Helvetica">Helvetica</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Verdana">Verdana</option>
                        </select>
                        <select class="text-sm border-none outline-none mr-2 text-google-gray bg-white cursor-pointer" id="fontSize">
                            <option value="11">11</option>
                            <option value="12" selected>12</option>
                            <option value="14">14</option>
                            <option value="16">16</option>
                            <option value="18">18</option>
                            <option value="24">24</option>
                        </select>
                        <button class="toolbar-btn p-2 rounded font-bold text-google-gray hover:bg-google-gray-light" title="Bold" id="boldBtn">B</button>
                        <button class="toolbar-btn p-2 rounded italic text-google-gray hover:bg-google-gray-light" title="Italic" id="italicBtn">I</button>
                        <button class="toolbar-btn p-2 rounded underline text-google-gray hover:bg-google-gray-light" title="Underline" id="underlineBtn">U</button>
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Text Color" id="textColorBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 16a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
                            </svg>
                        </button>
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Highlight Color" id="highlightBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                            </svg>
                        </button>
                    </div>

                    <!-- Paragraph -->
                    <div class="flex items-center space-x-1 border-r border-gray-300 pr-3 mr-3">
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Align Left" id="alignLeftBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 8a1 1 0 011-1h8a1 1 0 110 2H4a1 1 0 01-1-1zM3 12a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 16a1 1 0 011-1h8a1 1 0 110 2H4a1 1 0 01-1-1z"/>
                            </svg>
                        </button>
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Center" id="alignCenterBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M2 4a1 1 0 011-1h14a1 1 0 110 2H3a1 1 0 01-1-1zM4 8a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 12a1 1 0 011-1h14a1 1 0 110 2H3a1 1 0 01-1-1zM4 16a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1z"/>
                            </svg>
                        </button>
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Align Right" id="alignRightBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M2 4a1 1 0 011-1h14a1 1 0 110 2H3a1 1 0 01-1-1zM6 8a1 1 0 011-1h10a1 1 0 110 2H7a1 1 0 01-1-1zM2 12a1 1 0 011-1h14a1 1 0 110 2H3a1 1 0 01-1-1zM6 16a1 1 0 011-1h10a1 1 0 110 2H7a1 1 0 01-1-1z"/>
                            </svg>
                        </button>
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Justify" id="justifyBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 8a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 12a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 16a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
                            </svg>
                        </button>
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Line Spacing" id="lineSpacingBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4h14v2H3V4zM3 10h14v2H3v-2zM3 16h14v2H3v-2z"/>
                            </svg>
                        </button>
                    </div>

                    <!-- Lists -->
                    <div class="flex items-center space-x-1 border-r border-gray-300 pr-3 mr-3">
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Bulleted List" id="bulletListBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 100 2 1 1 0 000-2zM6 5a1 1 0 011-1h10a1 1 0 110 2H7a1 1 0 01-1-1zM3 9a1 1 0 100 2 1 1 0 000-2zM6 10a1 1 0 011-1h10a1 1 0 110 2H7a1 1 0 01-1-1zM3 14a1 1 0 100 2 1 1 0 000-2zM6 15a1 1 0 011-1h10a1 1 0 110 2H7a1 1 0 01-1-1z"/>
                            </svg>
                        </button>
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Numbered List" id="numberedListBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 8a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 12a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 16a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
                            </svg>
                        </button>
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Checklist" id="checklistBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                            </svg>
                        </button>
                    </div>

                    <!-- Insert -->
                    <div class="flex items-center space-x-1">
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Insert Link" id="linkBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z"/>
                            </svg>
                        </button>
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Insert Image" id="imageBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"/>
                            </svg>
                        </button>
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Insert Table" id="tableBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 000 2v9a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2H3zm3 2v2h2V6H6zm4 0v2h2V6h-2zm2 4h-2v2h2v-2zm-4 0H6v2h2v-2z"/>
                            </svg>
                        </button>
                        <button class="toolbar-btn p-2 rounded hover:bg-google-gray-light" title="Insert Drawing" id="drawingBtn">
                            <svg class="w-4 h-4 text-google-gray" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Editor Content -->
            <div class="editor-content flex flex-col bg-google-bg">
                <div class="document-wrapper">
                    <div class="max-w-4xl mx-auto bg-white document-shadow w-full">
                    <div class="max-w-4xl mx-auto bg-white document-shadow w-full">
                        <div class="document-content" id="documentContent">
                            <div class="line-content" data-line="1">
                                <h1 style="padding: 120px 120px 20px 120px; font-size: 24pt; line-height: 1.5; font-family: Times;">TechStart Solutions Business Plan</h1>
                            </div>
                            <div class="line-content" data-line="2">
                                <h2 style="padding: 20px 120px 15px 120px; font-size: 18pt; line-height: 1.5; font-family: Times;">1.0 Executive Summary</h2>
                            </div>
                            <div class="line-content" data-line="3">
                                <p style="padding: 0 120px 30px 120px; font-size: 12pt; line-height: 1.5; font-family: Times;">TechStart Solutions is an innovative technology company focused on developing cutting-edge software solutions for small to medium-sized businesses. Our mission is to democratize access to enterprise-level technology through affordable, user-friendly platforms.</p>
                            </div>
                            <div class="line-content" data-line="4">
                                <h2 style="padding: 20px 120px 15px 120px; font-size: 18pt; line-height: 1.5; font-family: Times;">2.0 Business Description</h2>
                            </div>
                            <div class="line-content" data-line="5">
                                <p style="padding: 0 120px 15px 120px; font-size: 12pt; line-height: 1.5; font-family: Times;">Our company specializes in creating comprehensive business management solutions that integrate seamlessly with existing workflows. We focus on automation, efficiency, and scalability to help businesses grow and thrive in today's competitive market.</p>
                            </div>
                            <div class="line-content" data-line="6">
                                <p style="padding: 0 120px 30px 120px; font-size: 12pt; line-height: 1.5; font-family: Times;">Founded in 2024, TechStart Solutions has quickly established itself as a trusted partner for businesses looking to modernize their operations through technology.</p>
                            </div>
                            <div class="line-content" data-line="7">
                                <h3 style="padding: 20px 120px 15px 120px; font-size: 16pt; line-height: 1.5; font-family: Times;">2.1 Company Overview</h3>
                            </div>
                            <div class="line-content" data-line="8">
                                <p style="padding: 0 120px 30px 120px; font-size: 12pt; line-height: 1.5; font-family: Times;">TechStart Solutions operates as a B2B software-as-a-service (SaaS) company with headquarters in San Francisco, California. Our team consists of experienced developers, designers, and business strategists committed to delivering exceptional value to our clients.</p>
                            </div>
                            <div class="line-content user-editing" data-line="9" data-user="alex">
                                <h3 style="padding: 20px 120px 15px 120px; font-size: 16pt; line-height: 1.5; font-family: Times; position: relative;">
                                    2.2 Products and Services
                                    <div class="editing-indicator">
                                        <div class="user-cursor" style="position: absolute; right: 100px; top: 25px;">
                                            <div style="width: 2px; height: 20px; background: #f59e0b; animation: blink 1s infinite;"></div>
                                            <div style="position: absolute; top: -25px; right: -50px; background: #f59e0b; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; white-space: nowrap;">Alex is typing...</div>
                                        </div>
                                    </div>
                                </h3>
                            </div>
                            <div class="line-content user-editing" data-line="10" data-user="alex">
                                <p style="padding: 0 120px 30px 120px; font-size: 12pt; line-height: 1.5; font-family: Times; background: rgba(245, 158, 11, 0.1); border-left: 3px solid #f59e0b; position: relative;">
                                    Our flagship product, BusinessFlow Pro, is a comprehensive management platform that includes project management, customer relationship management (CRM), and financial tracking capabilities. We also offer custom development services for businesses with specific requirements.
                                    <div class="user-selection" style="position: absolute; right: 100px; top: 15px; background: #f59e0b; color: white; padding: 2px 6px; border-radius: 4px; font-size: 9px;">
                                        <div style="display: flex; align-items: center; gap: 4px;">
                                            <div style="width: 12px; height: 12px; background: #f59e0b; border: 2px solid white; border-radius: 50%; font-size: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">A</div>
                                            Alex
                                        </div>
                                    </div>
                                </p>
                            </div>
                            <div class="line-content" data-line="11">
                                <h3 style="padding: 20px 120px 15px 120px; font-size: 16pt; line-height: 1.5; font-family: Times;">2.3 Market Analysis</h3>
                            </div>
                            <div class="line-content" data-line="12">
                                <p style="padding: 0 120px 30px 120px; font-size: 12pt; line-height: 1.5; font-family: Times;">The global business software market is projected to reach $1.2 trillion by 2026, with small and medium businesses representing a significant growth opportunity. Our target market includes companies with 10-500 employees seeking integrated business solutions.</p>
                            </div>
                            <div class="line-content" data-line="13">
                                <h3 style="padding: 20px 120px 15px 120px; font-size: 16pt; line-height: 1.5; font-family: Times;">2.4 Competitive Analysis</h3>
                            </div>
                            <div class="line-content" data-line="14">
                                <p style="padding: 0 120px 30px 120px; font-size: 12pt; line-height: 1.5; font-family: Times;">While established players like Salesforce and Microsoft dominate the enterprise market, there's a significant gap in affordable, easy-to-use solutions for smaller businesses. Our competitive advantage lies in our user-centric design and competitive pricing model.</p>
                            </div>
                            <div class="line-content" data-line="15">
                                <h3 style="padding: 20px 120px 15px 120px; font-size: 16pt; line-height: 1.5; font-family: Times;">2.5 Marketing Strategy</h3>
                            </div>
                            <div class="line-content" data-line="16">
                                <p style="padding: 0 120px 30px 120px; font-size: 12pt; line-height: 1.5; font-family: Times;">Our marketing approach focuses on digital channels, including content marketing, search engine optimization, and strategic partnerships with business consultants. We emphasize customer success stories and ROI demonstrations to build trust and credibility.</p>
                            </div>
                            <div class="line-content" data-line="17">
                                <h2 style="padding: 20px 120px 15px 120px; font-size: 18pt; line-height: 1.5; font-family: Times;">3.0 Industry Analysis</h2>
                            </div>
                            <div class="line-content" data-line="18">
                                <p style="padding: 0 120px 120px 120px; font-size: 12pt; line-height: 1.5; font-family: Times;">The business software industry continues to evolve rapidly, driven by cloud computing, artificial intelligence, and mobile accessibility. Key trends include increased demand for integrated platforms, real-time analytics, and remote collaboration tools.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Status Bar -->
            <div class="bg-white px-5 py-2 text-xs text-google-gray border-t border-google-border">
                Ready • Last edit was a few seconds ago
            </div>
        </div>

        <!-- AI Chatbot Panel -->
        <div class="w-96 bg-white fixed -right-96 top-0 h-screen shadow-xl transition-all duration-300 ease-in-out flex flex-col z-50 border-l border-google-border" id="chatbotPanel">
            <!-- Compact Chatbot Header -->
            <div class="bg-gradient-to-r from-google-blue to-blue-600 text-white px-4 py-3 flex justify-between items-center shadow-md">
                <div class="flex items-center gap-2">
                    <div class="w-6 h-6 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <svg class="w-3 h-3" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2l3.09 6.26L22 9l-5.91 4.74L18 22l-6-3.27L6 22l1.91-8.26L2 9l6.91-.74L12 2z"/>
                        </svg>
                    </div>
                    <div>
                        <div class="text-sm font-semibold">AI Assistant</div>
                        <div class="text-xs text-blue-100">Ready to help</div>
                    </div>
                </div>
                <button class="bg-transparent border-none text-white text-xl cursor-pointer p-1 rounded-full transition-all duration-200 ease-in-out w-8 h-8 flex items-center justify-center hover:bg-white hover:bg-opacity-20" id="closeChatBtn">
                    &times;
                </button>
            </div>

            <!-- AI Features Toolbar -->
            <div class="bg-white border-b border-google-border px-4 py-2">
                <div class="flex gap-2 flex-wrap">
                    <button class="flex items-center gap-1 px-3 py-1 bg-google-gray-light text-google-gray-dark text-xs rounded-full hover:bg-gray-200 transition-colors" id="githubRepoBtn">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z"/>
                        </svg>
                        GitHub
                    </button>
                    <button class="flex items-center gap-1 px-3 py-1 bg-google-gray-light text-google-gray-dark text-xs rounded-full hover:bg-gray-200 transition-colors" id="templatesBtn">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                        </svg>
                        Templates
                    </button>
                </div>
            </div>
            
            <!-- Chat Content - Copilot Style -->
            <div class="flex-1 flex flex-col bg-white overflow-hidden">
                <!-- Messages Container -->
                <div class="flex-1 overflow-y-auto px-4 py-3" id="chatMessages">
                    <!-- Welcome Message - Copilot Style -->
                    <div class="mb-6">
                        <div class="flex items-start gap-3 mb-4">
                            <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center flex-shrink-0">
                                <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2l3.09 6.26L22 9l-5.91 4.74L18 22l-6-3.27L6 22l1.91-8.26L2 9l6.91-.74L12 2z"/>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <div class="text-sm font-medium text-gray-900 mb-1">AI</div>
                                <div class="text-sm text-gray-600 leading-relaxed">
                                    <p class="mb-3">I'm here to help you write better documentation. I can:</p>
                                    <ul class="space-y-1 text-xs text-gray-500">
                                        <li>• Analyze and improve your writing</li>
                                        <li>• Review uploaded files and suggest edits</li>
                                        <li>• Help with code documentation</li>
                                        <li>• Generate content from templates</li>
                                    </ul>
                                    <p class="mt-3 text-xs text-gray-500">
                                        💡 <strong>Tip:</strong> Upload a file or ask me to help with specific sections of your document.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Input Area - Copilot Style with File Upload -->
                <div class="border-t border-gray-200 p-4">
                    <!-- File indicators -->
                    <div class="mb-2 flex flex-wrap gap-2">
                        <div class="file-indicator">
                            <svg class="file-indicator-icon" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4z"/>
                                <path d="M4 8h12v2H4V8z"/>
                            </svg>
                            <span>AI_Research.docx</span>
                        </div>
                        <div class="file-indicator">
                            <svg class="file-indicator-icon" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4z"/>
                                <path d="M4 8h12v2H4V8z"/>
                            </svg>
                            <span>Methodology_Notes.pdf</span>
                        </div>
                    </div>
                    
                    <!-- Current context indicator -->
                    <div class="mb-2 p-2 bg-blue-50 border border-blue-200 rounded-lg text-xs" id="currentTabIndicator">
                        <div class="flex items-center gap-2">
                            <svg class="w-3 h-3 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6.5a1.5 1.5 0 01-1.5 1.5H6.5A1.5 1.5 0 015 11.5V5z"/>
                            </svg>
                            <span class="text-blue-700 font-medium">1.0 Executive Summary</span>
                            <span class="text-blue-600">• Business Plan</span>
                        </div>
                    </div>
                    
                    <!-- Dynamic highlight indicators -->
                    <div id="highlightIndicators" class="mb-2 space-y-1">
                        <!-- Dynamic indicators will appear here when user highlights text -->
                    </div>
                    
                    <div class="flex items-end gap-3">
                        <div class="flex-1 relative">
                            <!-- File Upload Area -->
                            <div class="hidden mb-2" id="fileUploadArea">
                                <div class="flex items-center gap-2 p-2 bg-blue-50 border border-blue-200 rounded-lg text-sm">
                                    <svg class="w-4 h-4 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M8 4a4 4 0 00-4 4v4a4 4 0 004 4h4a4 4 0 004-4V8a4 4 0 00-4-4H8zM7 9a1 1 0 012 0v2a1 1 0 11-2 0V9z"/>
                                    </svg>
                                    <span class="text-blue-700" id="fileUploadText">Drop files here or click to browse</span>
                                    <button class="ml-auto text-blue-600 hover:text-blue-800" id="closeFileUpload">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Text Input with integrated controls -->
                            <div class="relative border border-gray-300 rounded-lg focus-within:border-purple-500 focus-within:ring-1 focus-within:ring-purple-500">
                                <textarea 
                                    class="w-full px-3 py-3 pr-20 border-none outline-none text-sm resize-none bg-transparent"
                                    id="chatInput"
                                    placeholder="Ask Copilot a question or type @ to upload files..."
                                    rows="1"
                                    style="min-height: 44px; max-height: 120px;"
                                ></textarea>
                                
                                <!-- Input Controls -->
                                <div class="absolute right-2 top-2 flex items-center gap-1">
                                    <!-- File Upload Button -->
                                    <button class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-colors" id="attachFileBtn" title="Attach file">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
                                        </svg>
                                    </button>
                                    
                                    <!-- Send Button -->
                                    <button class="p-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed" id="sendBtn" disabled>
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Hidden File Input -->
                            <input type="file" class="hidden" id="fileInput" multiple accept=".txt,.md,.js,.py,.html,.css,.json,.xml,.pdf,.docx">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- GitHub Repo Modal -->
        <div class="fixed inset-0 bg-black bg-opacity-50 z-60 hidden items-center justify-center" id="githubModal">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <h3 class="text-lg font-semibold mb-4">Connect GitHub Repository</h3>
                <input type="text" placeholder="Enter GitHub repo URL (e.g., owner/repo)" class="w-full px-3 py-2 border border-gray-300 rounded-lg mb-4" id="githubInput">
                <div class="flex gap-2">
                    <button class="flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300" id="cancelGithub">Cancel</button>
                    <button class="flex-1 bg-google-blue text-white px-4 py-2 rounded-lg hover:bg-google-blue-dark" id="confirmGithub">Connect</button>
                </div>
            </div>
        </div>

        <!-- Templates Modal -->
        <div class="fixed inset-0 bg-black bg-opacity-50 z-60 hidden items-center justify-center" id="templatesModal">
            <div class="bg-white rounded-lg p-6 max-w-lg w-full mx-4">
                <h3 class="text-lg font-semibold mb-4">Choose a Template</h3>
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <button class="p-3 border border-gray-200 rounded-lg hover:bg-gray-50 text-left template-btn" data-template="technical">
                        <div class="font-medium text-sm">Technical Documentation</div>
                        <div class="text-xs text-gray-600">API docs, user guides</div>
                    </button>
                    <button class="p-3 border border-gray-200 rounded-lg hover:bg-gray-50 text-left template-btn" data-template="research">
                        <div class="font-medium text-sm">Research Paper</div>
                        <div class="text-xs text-gray-600">Academic format</div>
                    </button>
                    <button class="p-3 border border-gray-200 rounded-lg hover:bg-gray-50 text-left template-btn" data-template="proposal">
                        <div class="font-medium text-sm">Project Proposal</div>
                        <div class="text-xs text-gray-600">Business plans</div>
                    </button>
                    <button class="p-3 border border-gray-200 rounded-lg hover:bg-gray-50 text-left template-btn" data-template="meeting">
                        <div class="font-medium text-sm">Meeting Notes</div>
                        <div class="text-xs text-gray-600">Structured notes</div>
                    </button>
                </div>
                <div class="flex gap-2">
                    <button class="flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300" id="cancelTemplates">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Notification Modal -->
        <div class="fixed inset-0 bg-black bg-opacity-50 z-60 hidden items-center justify-center" id="notificationModal">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Send Notification</h3>
                        <p class="text-sm text-gray-600">Notify Alex Johnson about your request</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Message:</label>
                    <textarea 
                        id="notificationMessage" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none" 
                        rows="3" 
                        placeholder="Hi Alex, I'm waiting to edit this section. Could you please finish up when convenient? Thanks!"
                    >Hi Alex, I'm waiting to edit this section. Could you please finish up when convenient? Thanks!</textarea>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                    <div class="flex items-center gap-2 text-sm text-blue-800">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"/>
                        </svg>
                        <span><strong>Section:</strong> <span id="notificationSectionName">2.2 Products and Services</span></span>
                    </div>
                </div>
                
                <div class="flex gap-2">
                    <button class="flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors" id="cancelNotification">
                        Cancel
                    </button>
                    <button class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors" id="sendNotification">
                        Send Notification
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Lock Reminder Modal -->
    <div class="lock-reminder" id="lockReminder">
        <div class="flex items-start gap-3 mb-4">
            <div class="w-12 h-12 bg-amber-100 rounded-full flex items-center justify-center">
                <svg class="w-6 h-6 text-amber-600" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"/>
                </svg>
            </div>
            <div class="flex-1">
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Section Currently Being Edited</h3>
                <p class="text-gray-600 mb-3">
                    Another user is currently editing this section. Please wait a moment for them to finish their changes.
                </p>
                <div class="bg-gray-50 p-3 rounded-lg mb-3">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-6 h-6 bg-amber-500 rounded-full flex items-center justify-center text-white text-xs font-bold">
                            A
                        </div>
                        <span class="text-sm font-medium">Alex Johnson</span>
                        <span class="text-xs text-gray-500">is editing</span>
                        <div class="w-2 h-2 bg-amber-500 rounded-full animate-pulse"></div>
                    </div>
                    <div class="text-sm text-gray-600">
                        <strong>Section:</strong> <span id="lockedSectionName">Methodology</span><br>
                        <strong>Editing since:</strong> 2 minutes ago
                    </div>
                </div>
                <div class="flex gap-2">
                    <button class="flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 text-sm" id="waitButton">
                        Wait for Access
                    </button>
                    <button class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm" id="notifyButton">
                        Notify User
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Background overlay for lock reminder -->
    <div class="fixed inset-0 bg-black bg-opacity-30 z-999 hidden" id="lockOverlay"></div>

    <script>
        // Get DOM elements
        const aiToggleBtn = document.getElementById('aiToggleBtn');
        const chatbotPanel = document.getElementById('chatbotPanel');
        const editorSection = document.getElementById('editorSection');
        const closeChatBtn = document.getElementById('closeChatBtn');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const chatMessages = document.getElementById('chatMessages');

        // Modal elements
        const githubModal = document.getElementById('githubModal');
        const templatesModal = document.getElementById('templatesModal');
        const notificationModal = document.getElementById('notificationModal');
        
        // Multi-user elements
        const lockReminder = document.getElementById('lockReminder');
        const lockOverlay = document.getElementById('lockOverlay');
        const lockReminderSectionName = document.getElementById('lockedSectionName');
        const waitButton = document.getElementById('waitButton');
        const notifyButton = document.getElementById('notifyButton');
        const currentTabIndicator = document.getElementById('currentTabIndicator');
        const sidebarTabs = document.querySelectorAll('.sidebar-tab');
        const lineContents = document.querySelectorAll('.line-content');
        const textSelections = document.querySelectorAll('.text-selection');
        
        // Feature buttons
        const githubRepoBtn = document.getElementById('githubRepoBtn');
        const templatesBtn = document.getElementById('templatesBtn');

        // File upload elements (integrated)
        const attachFileBtn = document.getElementById('attachFileBtn');
        const fileInput = document.getElementById('fileInput');
        const fileUploadArea = document.getElementById('fileUploadArea');
        const fileUploadText = document.getElementById('fileUploadText');
        const closeFileUpload = document.getElementById('closeFileUpload');

        // GitHub elements
        const githubInput = document.getElementById('githubInput');
        const cancelGithub = document.getElementById('cancelGithub');
        const confirmGithub = document.getElementById('confirmGithub');

        // Template elements
        const cancelTemplates = document.getElementById('cancelTemplates');
        const templateBtns = document.querySelectorAll('.template-btn');
        
        // Notification modal elements
        const cancelNotification = document.getElementById('cancelNotification');
        const sendNotification = document.getElementById('sendNotification');
        const notificationMessage = document.getElementById('notificationMessage');
        const notificationSectionName = document.getElementById('notificationSectionName');
        
        // Dynamic highlight tracking
        const highlightIndicators = document.getElementById('highlightIndicators');
        let activeHighlights = new Map(); // Track highlights by tab

        // Multi-user collaboration state
        let currentSelectedLine = null;
        let currentTab = 'executive';
        
        // Tab-to-line mapping
        const tabLineMapping = {
            'executive': { name: '1.0 Executive Summary', lines: [1, 2, 3] },
            'business': { name: '2.0 Business Description', lines: [4, 5, 6] },
            'overview': { name: '2.1 Company Overview', lines: [7, 8] },
            'products': { name: '2.2 Products and Services', lines: [9, 10] },
            'market': { name: '2.3 Market Analysis', lines: [11, 12] },
            'competitive': { name: '2.4 Competitive Analysis', lines: [13, 14] },
            'strategy': { name: '2.5 Marketing Strategy', lines: [15, 16] },
            'industry': { name: '3.0 Industry Analysis', lines: [17, 18] }
        };
        
        // Locked tabs (simulated)
        const lockedTabs = ['products'];
        
        // Multi-user functions
        function showLockReminder(tabName) {
            const tabInfo = tabLineMapping[tabName];
            if (tabInfo) {
                lockReminderSectionName.textContent = tabInfo.name;
                lockReminder.classList.add('show');
                lockOverlay.classList.remove('hidden');
            }
        }
        
        function hideLockReminder() {
            lockReminder.classList.remove('show');
            lockOverlay.classList.add('hidden');
        }
        
        // Dynamic highlight detection
        function detectTextSelection() {
            const selection = window.getSelection();
            if (selection.toString().trim().length > 0) {
                // Find which line and tab the selection belongs to
                const range = selection.getRangeAt(0);
                const container = range.commonAncestorContainer;
                const lineElement = container.nodeType === Node.TEXT_NODE 
                    ? container.parentElement.closest('.line-content')
                    : container.closest('.line-content');
                
                if (lineElement) {
                    const lineNumber = parseInt(lineElement.dataset.line);
                    const selectedText = selection.toString().trim();
                    
                    // Find which tab this line belongs to
                    for (const [tabKey, tabInfo] of Object.entries(tabLineMapping)) {
                        if (tabInfo.lines.includes(lineNumber)) {
                            // Check if this tab is locked - only show lock message for locked tabs
                            if (lockedTabs.includes(tabKey)) {
                                showLockReminder(tabKey);
                                return; // Exit early, don't add highlight indicator for locked sections
                            }
                            
                            // Only add highlight indicator for unlocked sections
                            addHighlightIndicator(tabKey, tabInfo.name, lineNumber, selectedText);
                            break;
                        }
                    }
                }
            }
        }
        
        function addHighlightIndicator(tabKey, tabName, lineNumber, selectedText) {
            // Generate a unique ID for this highlight
            const highlightId = `${tabKey}-${lineNumber}-${Date.now()}`;
            
            // Add to active highlights map
            if (!activeHighlights.has(tabKey)) {
                activeHighlights.set(tabKey, []);
            }
            
            const highlight = {
                id: highlightId,
                tabKey,
                tabName,
                lineNumber,
                selectedText: selectedText.substring(0, 30) + (selectedText.length > 30 ? '...' : '')
            };
            
            activeHighlights.get(tabKey).push(highlight);
            
            // Create indicator element
            const indicator = document.createElement('div');
            indicator.className = 'highlight-indicator';
            indicator.id = highlightId;
            indicator.innerHTML = `
                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6.5a1.5 1.5 0 01-1.5 1.5H6.5A1.5 1.5 0 015 11.5V5z"/>
                </svg>
                <span class="font-medium">${tabName}</span>
                <span>• Line ${lineNumber}</span>
                <span>• "${highlight.selectedText}"</span>
                <button class="highlight-indicator-close" onclick="removeHighlightIndicator('${highlightId}', '${tabKey}')">×</button>
            `;
            
            highlightIndicators.appendChild(indicator);
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                removeHighlightIndicator(highlightId, tabKey);
            }, 10000);
        }
        
        function removeHighlightIndicator(highlightId, tabKey) {
            const indicator = document.getElementById(highlightId);
            if (indicator) {
                indicator.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    indicator.remove();
                }, 300);
            }
            
            // Remove from active highlights
            if (activeHighlights.has(tabKey)) {
                const highlights = activeHighlights.get(tabKey);
                const index = highlights.findIndex(h => h.id === highlightId);
                if (index !== -1) {
                    highlights.splice(index, 1);
                }
                if (highlights.length === 0) {
                    activeHighlights.delete(tabKey);
                }
            }
        }
        
        // Add slideOut animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideOut {
                from {
                    opacity: 1;
                    transform: translateY(0);
                }
                to {
                    opacity: 0;
                    transform: translateY(-10px);
                }
            }
        `;
        document.head.appendChild(style);
        
        function updateCurrentTabIndicator(tabName, lineNumber = null, highlightedText = null) {
            const tabInfo = tabLineMapping[tabName];
            if (tabInfo) {
                let content = `
                    <div class="flex items-center gap-2">
                        <svg class="w-3 h-3 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6.5a1.5 1.5 0 01-1.5 1.5H6.5A1.5 1.5 0 015 11.5V5z"/>
                        </svg>
                        <span class="text-blue-700 font-medium">${tabInfo.name}</span>
                `;
                
                if (lineNumber) {
                    content += `<span class="text-blue-600">• Line ${lineNumber} selected</span>`;
                }
                
                if (highlightedText) {
                    content += `<span class="text-blue-600">• "${highlightedText}" highlighted</span>`;
                }
                
                content += `</div>`;
                
                currentTabIndicator.innerHTML = content;
            }
        }
        
        function selectLine(lineNumber) {
            // Clear previous selection
            lineContents.forEach(line => {
                line.classList.remove('selected-line');
            });
            
            // Highlight selected line
            const selectedLine = document.querySelector(`[data-line="${lineNumber}"]`);
            if (selectedLine) {
                selectedLine.classList.add('selected-line');
                currentSelectedLine = lineNumber;
                
                // Find which tab this line belongs to
                for (const [tabKey, tabInfo] of Object.entries(tabLineMapping)) {
                    if (tabInfo.lines.includes(lineNumber)) {
                        currentTab = tabKey;
                        
                        // Check if there's highlighted text in this line
                        const highlight = selectedLine.querySelector('.text-selection');
                        const highlightedText = highlight ? highlight.textContent : null;
                        
                        updateCurrentTabIndicator(tabKey, lineNumber, highlightedText);
                        updateSidebarSelection(tabKey);
                        break;
                    }
                }
            }
        }
        
        function updateSidebarSelection(tabName) {
            sidebarTabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                }
            });
        }
        
        function switchTab(tabName) {
            if (lockedTabs.includes(tabName)) {
                showLockReminder(tabName);
                return;
            }
            
            updateSidebarSelection(tabName);
            currentTab = tabName;
            updateCurrentTabIndicator(tabName);
            
            // Clear line selection when switching tabs
            lineContents.forEach(line => {
                line.classList.remove('selected-line');
            });
            currentSelectedLine = null;
        }
        
        // Event listeners for multi-user features
        sidebarTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                switchTab(tab.dataset.tab);
            });
        });
        
        // Add event listeners for text selections
        textSelections.forEach(selection => {
            selection.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent line selection
                
                // Find the parent line
                const parentLine = selection.closest('.line-content');
                if (parentLine) {
                    const lineNumber = parseInt(parentLine.dataset.line);
                    
                    // Check if this line belongs to a locked tab
                    for (const [tabKey, tabInfo] of Object.entries(tabLineMapping)) {
                        if (tabInfo.lines.includes(lineNumber) && lockedTabs.includes(tabKey)) {
                            showLockReminder(tabKey);
                            return;
                        }
                    }
                    
                    // Select the line and show the highlighted text
                    selectLine(lineNumber);
                    
                    // Additional visual feedback for selection
                    selection.style.background = '#4285f4';
                    selection.style.color = 'white';
                    setTimeout(() => {
                        selection.style.background = '#b3d9ff';
                        selection.style.color = 'inherit';
                    }, 1000);
                }
            });
        });
        
        lineContents.forEach(line => {
            line.addEventListener('click', () => {
                const lineNumber = parseInt(line.dataset.line);
                
                // Check if this line belongs to a locked tab
                for (const [tabKey, tabInfo] of Object.entries(tabLineMapping)) {
                    if (tabInfo.lines.includes(lineNumber) && lockedTabs.includes(tabKey)) {
                        showLockReminder(tabKey);
                        return;
                    }
                }
                
                selectLine(lineNumber);
            });
            
            // Add hover effect
            line.addEventListener('mouseenter', () => {
                line.classList.add('line-highlight');
            });
            
            line.addEventListener('mouseleave', () => {
                line.classList.remove('line-highlight');
            });
        });
        
        // Lock reminder button events
        waitButton.addEventListener('click', hideLockReminder);
        notifyButton.addEventListener('click', () => {
            // Show notification modal instead of immediately sending
            const lockedSection = lockReminderSectionName.textContent;
            notificationSectionName.textContent = lockedSection;
            hideLockReminder();
            showModal(notificationModal);
        });
        
        lockOverlay.addEventListener('click', hideLockReminder);
        
        // Text selection detection
        document.addEventListener('mouseup', () => {
            setTimeout(detectTextSelection, 100); // Small delay to ensure selection is complete
        });
        
        document.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft' || e.key === 'ArrowRight' || e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                setTimeout(detectTextSelection, 100);
            }
        });

        // Auto-resize textarea
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        // Enable/disable send button based on input
        function updateSendButton() {
            const hasText = chatInput.value.trim().length > 0;
            sendBtn.disabled = !hasText;
        }

        // Toggle chatbot panel
        function toggleChatbot() {
            const isOpen = chatbotPanel.classList.contains('right-0');
            
            if (isOpen) {
                closeChatbot();
            } else {
                openChatbot();
            }
        }

        function openChatbot() {
            chatbotPanel.classList.remove('-right-96');
            chatbotPanel.classList.add('right-0');
            editorSection.classList.add('mr-96');
            aiToggleBtn.innerHTML = `
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
                Close AI
            `;
            chatInput.focus();
        }

        function closeChatbot() {
            chatbotPanel.classList.remove('right-0');
            chatbotPanel.classList.add('-right-96');
            editorSection.classList.remove('mr-96');
            aiToggleBtn.innerHTML = `
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2l3.09 6.26L22 9l-5.91 4.74L18 22l-6-3.27L6 22l1.91-8.26L2 9l6.91-.74L12 2z"/>
                </svg>
                AI Assistant
            `;
        }

        // Modal functions
        function showModal(modal) {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function hideModal(modal) {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // Feature event listeners
        githubRepoBtn.addEventListener('click', () => showModal(githubModal));
        templatesBtn.addEventListener('click', () => showModal(templatesModal));

        // File upload functionality - integrated in input
        attachFileBtn.addEventListener('click', () => {
            fileInput.click();
        });

        // Show file upload area when @ is typed
        chatInput.addEventListener('input', (e) => {
            const value = e.target.value;
            autoResize(e.target);
            updateSendButton();
            
            if (value.includes('@') && !fileUploadArea.classList.contains('hidden')) {
                // Keep file upload area visible
            } else if (value.includes('@')) {
                showFileUploadArea();
            }
        });

        function showFileUploadArea() {
            fileUploadArea.classList.remove('hidden');
            fileUploadText.textContent = 'Drop files here or click to browse';
        }

        function hideFileUploadArea() {
            fileUploadArea.classList.add('hidden');
        }

        closeFileUpload.addEventListener('click', hideFileUploadArea);

        // Drag and drop on the file upload area
        fileUploadArea.addEventListener('click', () => fileInput.click());
        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('bg-blue-100', 'border-blue-300');
        });
        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.classList.remove('bg-blue-100', 'border-blue-300');
        });
        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('bg-blue-100', 'border-blue-300');
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        // Also allow drag and drop on the entire chat input area
        const inputContainer = chatInput.parentElement;
        inputContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
            showFileUploadArea();
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                addMessage(`� ${file.name}`, 'file');
                addMessage(`I've received your file "${file.name}". I can help you analyze, edit, or improve this document. What would you like me to do with it?`, 'ai');
            });
            hideFileUploadArea();
            // Remove @ from input if it exists
            chatInput.value = chatInput.value.replace('@', '');
            updateSendButton();
        }

        // GitHub functionality
        confirmGithub.addEventListener('click', () => {
            const repoUrl = githubInput.value.trim();
            if (repoUrl) {
                addMessage(`Connected to GitHub: ${repoUrl}`, 'system');
                addMessage(`I've connected to the repository "${repoUrl}". I can help you review code, suggest improvements, or generate documentation. What would you like to work on?`, 'ai');
                githubInput.value = '';
                hideModal(githubModal);
            }
        });

        cancelGithub.addEventListener('click', () => hideModal(githubModal));

        // Template functionality
        templateBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const template = btn.dataset.template;
                const templateName = btn.querySelector('.font-medium').textContent;
                
                const templates = {
                    technical: `# Technical Documentation

## Overview
Brief description of the project or feature.

## Requirements
- Requirement 1
- Requirement 2

## Implementation
Detailed implementation steps.

## API Reference
Document your APIs here.

## Examples
Code examples and usage.`,
                    research: `# Research Paper Title

## Abstract
Brief summary of the research.

## Introduction
Background and problem statement.

## Methodology
Research methods and approach.

## Results
Findings and data analysis.

## Discussion
Interpretation of results.

## Conclusion
Summary and future work.

## References
Bibliography and citations.`,
                    proposal: `# Project Proposal

## Executive Summary
Brief overview of the proposal.

## Problem Statement
What problem are we solving?

## Proposed Solution
How will we solve it?

## Timeline
Project milestones and deadlines.

## Budget
Cost breakdown and resources.

## Expected Outcomes
What we aim to achieve.`,
                    meeting: `# Meeting Notes

**Date:** ${new Date().toLocaleDateString()}
**Attendees:** 
**Duration:** 

## Agenda
1. Topic 1
2. Topic 2
3. Topic 3

## Discussion Points
- Point 1
- Point 2

## Action Items
- [ ] Task 1 - Assignee
- [ ] Task 2 - Assignee

## Next Steps
What happens next?`
                };

                document.getElementById('textEditor').value = templates[template];
                addMessage(`Applied template: ${templateName}`, 'system');
                addMessage(`I've applied the "${templateName}" template to your document. Feel free to customize it or ask me to help you fill in specific sections!`, 'ai');
                hideModal(templatesModal);
            });
        });

        cancelTemplates.addEventListener('click', () => hideModal(templatesModal));

        // Notification modal functionality
        cancelNotification.addEventListener('click', () => hideModal(notificationModal));
        
        sendNotification.addEventListener('click', () => {
            const message = notificationMessage.value.trim();
            const sectionName = notificationSectionName.textContent;
            
            if (message) {
                // Show success message
                addMessage(`📨 Notification sent to Alex Johnson about "${sectionName}"`, 'system');
                addMessage(`Your message: "${message}"`, 'system');
                addMessage('I\'ve notified Alex that you\'re waiting to edit this section. They should finish up soon!', 'ai');
                
                // Hide modal and show success popup
                hideModal(notificationModal);
                showNotificationSuccess();
            }
        });
        
        // Show notification success popup
        function showNotificationSuccess() {
            const popup = document.createElement('div');
            popup.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 ease-in-out';
            popup.style.transform = 'translateX(100%)';
            popup.innerHTML = `
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                    </svg>
                    <span>Notification sent successfully!</span>
                </div>
            `;
            
            document.body.appendChild(popup);
            
            // Animate in
            setTimeout(() => {
                popup.style.transform = 'translateX(0)';
            }, 100);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                popup.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(popup);
                }, 300);
            }, 3000);
        }

        // Chat functionality
        function sendMessage() {
            const message = chatInput.value.trim();
            if (message) {
                addMessage(message, 'user');
                chatInput.value = '';
                autoResize(chatInput);
                updateSendButton();
                
                // Enhanced AI responses
                setTimeout(() => {
                    const responses = [
                        "I'd be happy to help you with that! Could you provide more details about what you're working on?",
                        "Great question! Based on your document, I suggest we focus on improving the structure and clarity.",
                        "I can help you with that. Would you like me to review your current content or suggest new ideas?",
                        "That's an interesting approach. Let me help you refine that section for better readability.",
                        "I notice you might benefit from a more structured format. Would you like me to suggest an outline?"
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    addMessage(randomResponse, 'ai');
                }, 800);
            }
        }

        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            
            if (sender === 'system') {
                messageDiv.className = 'mb-3 p-3 bg-green-50 border border-green-200 rounded-lg text-green-800 text-sm';
                messageDiv.innerHTML = `
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span>${text}</span>
                    </div>
                `;
            } else if (sender === 'file') {
                messageDiv.className = 'mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg text-blue-800 text-sm';
                messageDiv.innerHTML = `
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 4a4 4 0 00-4 4v4a4 4 0 004 4h4a4 4 0 004-4V8a4 4 0 00-4-4H8zM7 9a1 1 0 012 0v2a1 1 0 11-2 0V9z"/>
                        </svg>
                        <span>${text}</span>
                    </div>
                `;
            } else {
                messageDiv.className = 'mb-4 flex items-start gap-3';
                
                const avatar = sender === 'user' 
                    ? `<div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
                         <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                           <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/>
                         </svg>
                       </div>`
                    : `<div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center flex-shrink-0">
                         <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="currentColor">
                           <path d="M12 2l3.09 6.26L22 9l-5.91 4.74L18 22l-6-3.27L6 22l1.91-8.26L2 9l6.91-.74L12 2z"/>
                         </svg>
                       </div>`;
                
                messageDiv.innerHTML = `
                    ${avatar}
                    <div class="flex-1">
                        <div class="text-sm font-medium text-gray-900 mb-1">${sender === 'user' ? 'You' : 'GitHub Copilot'}</div>
                        <div class="text-sm text-gray-700 leading-relaxed">${text}</div>
                    </div>
                `;
            }
            
            // Remove welcome message if it exists
            const welcomeMsg = chatMessages.querySelector('.mb-6');
            if (welcomeMsg && (sender === 'user' || sender === 'ai')) {
                welcomeMsg.remove();
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Event listeners
        aiToggleBtn.addEventListener('click', toggleChatbot);
        closeChatBtn.addEventListener('click', closeChatbot);
        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        chatInput.addEventListener('input', (e) => {
            autoResize(e.target);
            updateSendButton();
        });

        // Initialize with default state
        updateCurrentTabIndicator('executive');
        
        // Initialize
        updateSendButton();

        // Close modals when clicking outside
        [githubModal, templatesModal].forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    hideModal(modal);
                }
            });
        });

        // Auto-resize text editor and handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth <= 768 && chatbotPanel.classList.contains('right-0')) {
                editorSection.style.display = 'none';
            } else {
                editorSection.style.display = 'flex';
            }
        });

        // Google Docs Toolbar Functionality
        function execCommand(command, value = null) {
            document.execCommand(command, false, value);
            const textEditor = document.getElementById('textEditor');
            if (textEditor) textEditor.focus();
        }

        // Toolbar event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Format buttons
            const boldBtn = document.getElementById('boldBtn');
            const italicBtn = document.getElementById('italicBtn');
            const underlineBtn = document.getElementById('underlineBtn');
            const alignLeftBtn = document.getElementById('alignLeftBtn');
            const alignCenterBtn = document.getElementById('alignCenterBtn');
            const alignRightBtn = document.getElementById('alignRightBtn');
            const justifyBtn = document.getElementById('justifyBtn');
            const bulletListBtn = document.getElementById('bulletListBtn');
            const numberedListBtn = document.getElementById('numberedListBtn');
            const undoBtn = document.getElementById('undoBtn');
            const redoBtn = document.getElementById('redoBtn');
            const linkBtn = document.getElementById('linkBtn');
            const imageBtn = document.getElementById('imageBtn');
            const fontFamily = document.getElementById('fontFamily');
            const fontSize = document.getElementById('fontSize');

            // Add event listeners
            if (boldBtn) boldBtn.addEventListener('click', () => execCommand('bold'));
            if (italicBtn) italicBtn.addEventListener('click', () => execCommand('italic'));
            if (underlineBtn) underlineBtn.addEventListener('click', () => execCommand('underline'));
            if (alignLeftBtn) alignLeftBtn.addEventListener('click', () => execCommand('justifyLeft'));
            if (alignCenterBtn) alignCenterBtn.addEventListener('click', () => execCommand('justifyCenter'));
            if (alignRightBtn) alignRightBtn.addEventListener('click', () => execCommand('justifyRight'));
            if (justifyBtn) justifyBtn.addEventListener('click', () => execCommand('justifyFull'));
            if (bulletListBtn) bulletListBtn.addEventListener('click', () => execCommand('insertUnorderedList'));
            if (numberedListBtn) numberedListBtn.addEventListener('click', () => execCommand('insertOrderedList'));
            if (undoBtn) undoBtn.addEventListener('click', () => execCommand('undo'));
            if (redoBtn) redoBtn.addEventListener('click', () => execCommand('redo'));

            if (linkBtn) linkBtn.addEventListener('click', () => {
                const url = prompt('Enter URL:');
                if (url) execCommand('createLink', url);
            });

            if (imageBtn) imageBtn.addEventListener('click', () => {
                const url = prompt('Enter image URL:');
                if (url) execCommand('insertImage', url);
            });

            if (fontFamily) fontFamily.addEventListener('change', (e) => {
                execCommand('fontName', e.target.value);
            });

            if (fontSize) fontSize.addEventListener('change', (e) => {
                execCommand('fontSize', e.target.value);
            });
        });

    </script>
</body>
</html>